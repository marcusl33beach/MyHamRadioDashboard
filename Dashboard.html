<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyHamDashboard</title>
    <style>
        /* GLOBAL RESET */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow: hidden; 
            font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #1a1a1a; 
            color: #f0f0f0;
        }

        #page-container {
            display: flex;
            flex-direction: column;
            height: 100vh; 
            position: relative;
        }

        /* GRID LAYOUT (4x3) */
        #grid-container {
            flex-grow: 1; 
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(3, 1fr);
            width: 100%;
            height: 100%;
            overflow: hidden; 
        }

        .grid-item {
            width: 100%;
            height: 100%;
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-sizing: border-box; 
            background-color: #000;
            overflow: hidden; 
            position: relative;
            cursor: pointer; 
            transition: transform 0.1s;
        }

        .grid-item:hover {
            transform: scale(1.02);
            z-index: 5;
            box-shadow: 0 0 10px rgba(0,0,0,0.8);
        }

        /* CONTENT STYLING */
        .grid-item img, 
        .grid-item video,
        .grid-item iframe { 
            width: 100%;
            height: 100%;
            display: block;
            border: none;
            object-fit: cover; /* Default: Fill the box (crop if needed) */
        }

        .grid-item iframe { object-fit: fill; }
        
        /* Class to prevent cropping (Zoom Out) */
        .grid-item img.contain-fit { object-fit: contain; }

        /* ----------------------------------------------------- */
        /* COMPACT TICKER & INTEGRATED MENU STYLES               */
        /* ----------------------------------------------------- */
        #ticker-wrap {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 30px; 
            background-color: rgba(0, 0, 0, 0.75); 
            border-top: 1px solid #555;
            overflow: visible; 
            white-space: nowrap;
            z-index: 9999; 
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        #ticker-title {
            background-color: rgba(0, 0, 0, 0.75); 
            color: white;
            padding: 0 15px;
            height: 100%;
            display: flex;
            align-items: center;
            font-weight: bold;
            font-size: 0.85em; 
            z-index: 10;
            border-right: 1px solid #555; 
            cursor: pointer; 
            position: relative; 
            transition: background-color 0.3s;
        }

        #ticker-title:hover {
            background-color: #333; 
        }

        /* Dropdown Menu */
        .dropdown-content {
            display: none;
            position: absolute;
            bottom: 30px; 
            left: 0;
            background-color: rgba(0, 0, 0, 0.9);
            min-width: 200px;
            box-shadow: 0px -4px 16px rgba(0,0,0,0.5);
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            overflow: hidden;
            border: 1px solid #444;
            border-bottom: none;
            backdrop-filter: blur(5px);
        }

        .dropdown-content a {
            color: #f0f0f0;
            padding: 10px 16px;
            text-decoration: none;
            display: block;
            font-size: 0.9em;
            border-bottom: 1px solid #333;
            transition: background 0.2s;
        }

        .dropdown-content a:hover {
            background-color: #b00; 
        }

        #ticker-title:hover .dropdown-content {
            display: block;
        }

        /* Scrolling Text */
        #ticker-move {
            display: inline-block;
            padding-left: 100%;
            animation: scroll-left 30s linear infinite;
            color: #fff;
            font-size: 0.95em; 
            font-weight: 500;
            line-height: 30px; 
        }

        @keyframes scroll-left {
            0%   { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* ----------------------------------------------------- */
        /* LIGHTBOX STYLES                                       */
        /* ----------------------------------------------------- */
        #lightbox {
            display: none; 
            position: fixed;
            z-index: 10000; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9); 
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .lightbox-content {
            max-width: 95%;
            max-height: 95%;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            border: 2px solid #333;
        }

        #lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: #f1f1f1;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
        }

        #lightbox-close:hover {
            color: #b00;
        }
        
    </style>
</head>
<body>

    <div id="page-container">
        <main id="grid-container"></main>
        
        <!-- COMPACT TICKER BAR -->
        <div id="ticker-wrap">
            <div id="ticker-title">
                Menu &#9650; 
                <div class="dropdown-content">
                    <a href="https://www.weather.gov/" target="_blank">NWS Home</a>
                    <a href="https://mygmrs.com/" target="_blank">MyGMRS</a>
                    <a href="https://www.qrz.com/" target="_blank">QRZ.com</a>
                    <a href="https://www.radioreference.com/db/browse/stid/21" target="_blank">RadioReference KY</a>
                    <a href="https://www.repeaterbook.com/repeaters/index.php?state_id=21" target="_blank">RepeaterBook KY</a>
                    <a href="javascript:location.reload()">Refresh Dashboard</a>
                </div>
            </div>
            <div id="ticker-move" id="ticker-content">Loading Weather Data...</div>
        </div>
    </div>

    <!-- LIGHTBOX CONTAINER -->
    <div id="lightbox" onclick="closeLightbox()">
        <span id="lightbox-close">&times;</span>
        <img id="lightbox-img" style="display:none;" class="lightbox-content">
        <video id="lightbox-video" style="display:none;" class="lightbox-content" controls autoplay loop></video>
    </div>

    <script>
        /* 1. DEFINE CONTENT URLs */
        const contentUrls = [
            'https://radar.weather.gov/ridge/standard/CONUS_loop.gif', 
            'https://graphical.weather.gov/images/conus/T1_conus.png', 
            'https://services.swpc.noaa.gov/images/animations/d-rap/global/d-rap/latest.png', 
            
            // ZOOMED OUT (Using contain-fit logic): SWPC Overview
            'https://services.swpc.noaa.gov/images/swx-overview-large.gif', 
            
            'https://cdn.star.nesdis.noaa.gov/GOES16/GLM/SECTOR/can/EXTENT3/GOES16-CAN-EXTENT3-1125x560.gif', 
            'https://cdn.star.nesdis.noaa.gov/GOES16/GLM/SECTOR/cgl/EXTENT3/GOES16-CGL-EXTENT3-600x600.gif', 
            'https://services.swpc.noaa.gov/experimental/images/aurora_dashboard/tonights_static_viewline_forecast.png', 
            'https://www.blitzortung.org/en/Images/image_b_ny.png', 
            
            'https://www.trimarc.org/images/milestone/CCTV_06_275_0089.jpg', 
            'https://cdn.star.nesdis.noaa.gov/GOES16/ABI/SECTOR/can/13/GOES16-CAN-13-1125x560.gif', 
            
            // REPLACED: Full Disk Earth View (Shows Day/Night Terminator Line reliably)
            'https://cdn.star.nesdis.noaa.gov/GOES16/ABI/FD/GEOCOLOR/latest.jpg', 
            
            'https://www.hamqsl.com/solar101vhfpic.php' 
        ];

        /* 2. HELPER: DETERMINE CONTENT TYPE */
        function getContentType(url) {
            const lowerUrl = url.toLowerCase();
            if (lowerUrl.endsWith('.mp4')) return 'video';
            if (lowerUrl.includes('solarpic') || lowerUrl.includes('solar101vhfpic')) return 'img';
            return 'img'; 
        }

        /* 3. GRID BUILDER LOGIC */
        const gridContainer = document.getElementById('grid-container');

        function buildGrid() {
            contentUrls.forEach(url => {
                const contentType = getContentType(url);
                const gridItem = document.createElement('div');
                gridItem.classList.add('grid-item');
                
                // Add click event for lightbox
                if (contentType !== 'iframe') {
                    gridItem.onclick = function() {
                        openLightbox(url, contentType);
                    };
                }

                let el;
                if (contentType === 'video') {
                    el = document.createElement('video');
                    el.src = url;
                    el.autoplay = true; el.loop = true; el.muted = true; el.controls = false;
                } else {
                    el = document.createElement('img');
                    el.src = url;
                    
                    // FIX: Apply contain-fit to HamQSL AND the SWX Overview so they aren't cropped
                    if(url.includes('hamqsl') || url.includes('swx-overview')) {
                        el.classList.add('contain-fit');
                    }
                    
                    el.onerror = function() { this.style.display='none'; }; 
                }
                
                gridItem.appendChild(el);
                gridContainer.appendChild(gridItem);
            });
        }

        /* 4. LIGHTBOX LOGIC */
        function openLightbox(url, type) {
            const lightbox = document.getElementById('lightbox');
            const imgEl = document.getElementById('lightbox-img');
            const videoEl = document.getElementById('lightbox-video');

            // Reset display
            imgEl.style.display = 'none';
            videoEl.style.display = 'none';
            videoEl.pause();

            if (type === 'video') {
                videoEl.src = url;
                videoEl.style.display = 'block';
                videoEl.play();
            } else {
                // Force refresh for live images
                const timestamp = new Date().getTime();
                const freshUrl = url.includes('?') ? url + '&t=' + timestamp : url + '?t=' + timestamp;
                
                imgEl.src = freshUrl;
                imgEl.style.display = 'block';
            }

            lightbox.style.display = 'flex';
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            const videoEl = document.getElementById('lightbox-video');
            
            lightbox.style.display = 'none';
            videoEl.pause();
            videoEl.src = ""; 
        }

        /* 5. WEATHER TICKER LOGIC */
        const RSS_URL = "https://alerts.weather.gov/cap/wwaatmget.php?x=KYZ091&y=0&a=0";
        const API_URL = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(RSS_URL);

        function updateTicker() {
            const ticker = document.getElementById('ticker-move');
            
            fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok' && data.items.length > 0) {
                    let alertText = "";
                    data.items.forEach(item => {
                        alertText += " ⚠️ " + item.title + " ";
                    });
                    ticker.innerText = alertText + " (Source: NWS) ";
                } else {
                    ticker.innerText = "NO ACTIVE WEATHER ALERTS FOR BOONE COUNTY, KY";
                }
            })
            .catch(error => {
                console.error("Ticker Error:", error);
                ticker.innerText = "Weather Data Unavailable (Check Internet Connection)";
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            buildGrid();
            updateTicker();
            setInterval(updateTicker, 900000);
        });
    </script>
</body>
</html>