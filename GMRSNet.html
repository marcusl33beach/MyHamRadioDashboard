<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GMRS Net Logger</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 20px; background: #f4f4f4; }
        
        /* Layout */
        .container { max-width: 800px; margin: auto; }
        .section { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Header and Control Inputs */
        #netControlSection { border-left: 5px solid #27ae60; }
        #netControlSection input:disabled { background: #f1f1f1; color: #555; }
        .flex-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        input[type="text"], input[type="datetime-local"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; flex-grow: 1; }
        button { padding: 8px 15px; background: #2980b9; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #3498db; }
        
        /* Check-In Inputs */
        #checkInSection { border-left: 5px solid #f39c12; }
        #checkInSection textarea { width: 100%; resize: vertical; margin-top: 5px; padding: 5px; border: 1px solid #ccc; border-radius: 4px; }
        
        /* Log Display */
        #logDisplay { background: #ecf0f1; padding: 10px; border-radius: 4px; max-height: 400px; overflow-y: auto; }
        .log-group { margin-bottom: 15px; border-bottom: 1px dashed #bdc3c7; padding-bottom: 10px; }
        .log-group h4 { margin-top: 0; color: #2c3e50; }
        .log-entry { padding: 5px 0; border-bottom: 1px dotted #ccc; display: flex; gap: 10px; font-size: 14px; }
        .log-entry:last-child { border-bottom: none; }
        .entry-call { font-weight: bold; color: #c0392b; }
        .entry-time { font-style: italic; color: #7f8c8d; }
    </style>
</head>
<body>

<div class="container">
    <h1>GMRS Net Check-In Log</h1>

    <div id="netControlSection" class="section">
        <h3>Net Control Setup</h3>
        <div class="flex-row">
            <input type="text" id="netControlCall" placeholder="Net Control Call Sign (e.g., WRZP123)">
            <input type="datetime-local" id="netStartTime" title="Net Start Time and Date">
            <button id="saveControlBtn" onclick="saveNetControl()">Start Net</button>
        </div>
    </div>

    <div id="checkInSection" class="section">
        <h3>Log Check-In</h3>
        <div class="flex-row">
            <input type="text" id="checkInCall" placeholder="Check-In Call Sign" required>
            <input type="text" id="checkInLocation" placeholder="Location/Grid Square (Optional)">
            <button onclick="logCheckIn()">Log Check-In</button>
        </div>
        <textarea id="checkInNotes" placeholder="Notes (Signal Report, Repeater used, Traffic, etc.)"></textarea>
    </div>

    <div id="logDisplaySection" class="section">
        <h3>Net History</h3>
        <div id="logDisplay">
            <p style="text-align: center; color: #95a5a6;">Log entries will appear here, grouped by the Net Start Date.</p>
        </div>
    </div>
</div>

<script>
    const STORAGE_KEY = 'gmrs_net_logs';
    let currentNetID = null; // Stores the unique ID of the currently active net (the start date)

    // --- Core Functions for Storage and Display ---

    /**
     * Loads all net logs from Local Storage and renders them.
     */
    function loadLogs() {
        const logs = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        const logDisplay = document.getElementById('logDisplay');
        logDisplay.innerHTML = ''; // Clear existing logs

        // Sort nets by date (newest first)
        const sortedDates = Object.keys(logs).sort().reverse();

        if (sortedDates.length === 0) {
            logDisplay.innerHTML = '<p style="text-align: center; color: #95a5a6;">No saved net history.</p>';
            return;
        }

        sortedDates.forEach(dateID => {
            const net = logs[dateID];
            const netGroup = document.createElement('div');
            netGroup.className = 'log-group';
            
            // Format the Net Start Date and Time for display
            const formattedDate = new Date(dateID).toLocaleString();
            
            // Header for the net log group
            netGroup.innerHTML = `
                <h4>Net: ${formattedDate} (${net.netControlCall})</h4>
            `;

            // List all check-ins for this net
            net.checkIns.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'log-entry';
                entryDiv.innerHTML = `
                    <span class="entry-time">${new Date(entry.timestamp).toLocaleTimeString()}</span>
                    <span class="entry-call">${entry.callsign}</span>
                    <span>${entry.location ? ' | Loc: ' + entry.location : ''}</span>
                    <span> | Note: ${entry.notes}</span>
                `;
                netGroup.appendChild(entryDiv);
            });

            logDisplay.appendChild(netGroup);
        });
    }

    /**
     * Saves the Net Control Call Sign and Start Time, then greys out the inputs.
     */
    function saveNetControl() {
        const ncCall = document.getElementById('netControlCall').value.toUpperCase().trim();
        const startTimeInput = document.getElementById('netStartTime');
        const startTime = startTimeInput.value;

        if (!ncCall || !startTime) {
            alert("Please enter both Net Control Call Sign and Start Time/Date.");
            return;
        }

        // Use the start time input value as the unique ID for the log group
        currentNetID = startTime;

        // 1. Load existing data
        const logs = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        // 2. Create a new net entry keyed by the start date/time
        logs[currentNetID] = {
            netControlCall: ncCall,
            checkIns: []
        };

        // 3. Save back to Local Storage
        localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));

        // 4. Update UI
        document.getElementById('netControlCall').disabled = true;
        startTimeInput.disabled = true;
        document.getElementById('saveControlBtn').disabled = true;
        document.getElementById('saveControlBtn').textContent = 'Net Active';
        
        alert(`Net started: ${ncCall} at ${new Date(startTime).toLocaleString()}`);
        loadLogs(); // Refresh the display
    }

    /**
     * Logs a check-in and saves it to the currently active net in Local Storage.
     */
    function logCheckIn() {
        if (!currentNetID) {
            alert("Please start the Net first using the 'Start Net' button.");
            return;
        }
        
        const callsign = document.getElementById('checkInCall').value.toUpperCase().trim();
        const location = document.getElementById('checkInLocation').value.trim();
        const notes = document.getElementById('checkInNotes').value.trim();

        if (!callsign) {
            alert("Check-In Call Sign is required.");
            return;
        }
        
        // The check-in object
        const newCheckIn = {
            timestamp: new Date().toISOString(), // Use current time
            callsign: callsign,
            location: location,
            notes: notes
        };

        // 1. Load all logs
        const logs = JSON.parse(localStorage.getItem(STORAGE_KEY));

        // 2. Add the new check-in to the current net's checkIns array
        logs[currentNetID].checkIns.push(newCheckIn);

        // 3. Save back to Local Storage
        localStorage.setItem(STORAGE_KEY, JSON.stringify(logs));

        // 4. Reset check-in inputs for the next entry
        document.getElementById('checkInCall').value = '';
        document.getElementById('checkInLocation').value = '';
        document.getElementById('checkInNotes').value = '';
        document.getElementById('checkInCall').focus(); // Ready for next entry

        loadLogs(); // Update the display with the new entry
    }

    // Load logs when the page first loads
    document.addEventListener('DOMContentLoaded', loadLogs);
</script>

</body>
</html>